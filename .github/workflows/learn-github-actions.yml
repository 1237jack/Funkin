name: learn-github-actions
on: [push]
jobs:
  create-nightly-linux:
    runs-on: ubuntu-latest
    steps:
      - uses: krdlab/setup-haxe@v1.1.6
        with:
          haxe-version: 4.2.4
      - uses: actions/checkout@v2
      - name: Cache Haxe Stuff
        run: |
          haxelib config
      - name: Installing Haxe Stuff
        run: |
          haxe -version
          haxelib install openfl --quiet
          haxelib install lime --quiet
          haxelib install flixel --quiet
          haxelib install flixel-addons --quiet
          haxelib install hscript --quiet
          haxelib install flixel-ui --quiet
          haxelib install firetongue --quiet
          haxelib install hxcpp-debug-server --quiet
          haxelib install hxcpp --quiet
          haxelib git polymod https://github.com/larsiusprime/polymod develop --quiet
          haxelib run lime setup linux
      - name: Build game?
        run: |
          haxelib run lime build html5 -debug -clean
          ls
      - name: Install butler and shit
        run: |
          curl -L -o butler.zip https://broth.itch.ovh/butler/linux-amd64/LATEST/archive/default
          unzip butler.zip
          chmod +x butler
          ./butler -V
      - name: Upload game to itch.io
        env: 
          BUTLER_API_KEY: ${{ secrets.BUTLER_API_KEY}}
        run: |
          ./butler login
          ./butler push export/debug/html5/bin ninja-muffin24/funkin-secret:html5
      - uses: actions/upload-artifact@v1
        with:
          name: funkinSecret-${{ runner.os }}-${{ github.sha }}
          path: export/debug/html5/bin

